<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEO-PULSE HUB | ملابس الأطفال والجيل القادم</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; background-color: #030303; color: #ffffff; margin: 0; overflow-x: hidden; }
        
        .glass { background: rgba(10, 10, 10, 0.8); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .neo-gradient { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
        .text-gradient { background: linear-gradient(to right, #fff, #a5b4fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .product-card { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .product-card:hover { transform: translateY(-10px); border-color: #6366f1; }
        
        [x-cloak] { display: none !important; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #6366f1; border-radius: 20px; }

        .category-tag { @apply px-4 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border border-white/10 bg-white/5; }
    </style>
</head>
<body x-data="hubApp()" x-init="init()">

    <!-- شريط الحالة -->
    <header class="fixed top-0 w-full z-[100] glass border-b border-white/5 px-6 py-2">
        <div class="max-w-[1800px] mx-auto flex justify-between items-center text-[9px] font-black uppercase text-zinc-500">
            <div class="flex items-center gap-4">
                <span class="text-indigo-400">NEO-KIDS DIVISION</span>
                <span class="w-[1px] h-3 bg-white/10"></span>
                <span>الحالة: متصل</span>
            </div>
            <div x-text="currentTime"></div>
        </div>
    </header>

    <!-- الهيدر -->
    <nav class="fixed top-[33px] w-full z-[99] glass-bright bg-black/50 backdrop-blur-xl px-8 py-4 border-b border-white/5">
        <div class="max-w-[1800px] mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" @dblclick="isAdminOpen = true">
                <div class="w-10 h-10 neo-gradient rounded-lg flex items-center justify-center">
                    <i data-lucide="baby" class="text-white w-6 h-6"></i>
                </div>
                <h1 class="text-2xl font-black italic">NEO<span class="text-indigo-500">KIDS</span></h1>
            </div>

            <!-- الفلاتر السريعة -->
            <div class="hidden md:flex gap-6">
                <template x-for="cat in categories">
                    <button @click="activeTab = cat.id" 
                            :class="activeTab === cat.id ? 'text-indigo-400 border-indigo-500' : 'text-zinc-500 border-transparent'"
                            class="text-[10px] font-black uppercase tracking-widest border-b-2 pb-1 transition-all" 
                            x-text="cat.name"></button>
                </template>
            </div>

            <div class="flex items-center gap-6">
                <button @click="isCartOpen = true" class="relative p-2">
                    <i data-lucide="shopping-bag" class="w-6 h-6"></i>
                    <span x-show="cart.length > 0" x-text="cart.length" class="absolute -top-1 -right-1 bg-white text-black text-[9px] w-4 h-4 flex items-center justify-center rounded-full font-bold"></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- المحتوى -->
    <main class="max-w-[1800px] mx-auto px-8 pt-40 pb-20">
        
        <!-- بنر العرض -->
        <div class="mb-16 p-12 rounded-[3rem] glass border-white/5 relative overflow-hidden">
            <div class="relative z-10 max-w-2xl">
                <h2 class="text-6xl font-black italic text-gradient mb-6 leading-none">ملابس المستقبل<br>لأطفال اليوم.</h2>
                <p class="text-zinc-500 text-lg mb-8">من الرضع إلى المراهقين، نقدم تصاميم تجمع بين الراحة القصوى والأسلوب المستقبلي.</p>
                <div class="flex gap-4">
                    <span class="category-tag">توصيل مجاني</span>
                    <span class="category-tag">ضمان استبدال</span>
                </div>
            </div>
            <div class="absolute top-0 left-0 w-1/2 h-full opacity-20 pointer-events-none">
                <i data-lucide="sparkles" class="w-full h-full text-indigo-500 p-20"></i>
            </div>
        </div>

        <!-- شبكة المنتجات الديناميكية -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
            <template x-for="p in filteredProducts" :key="p.id">
                <div class="glass product-card p-5 rounded-[2.5rem] flex flex-col group">
                    <div class="relative aspect-[3/4] rounded-[2rem] overflow-hidden mb-6 bg-zinc-900">
                        <img :src="p.img" :alt="p.name" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                        <div class="absolute top-4 right-4">
                            <span class="bg-black/80 backdrop-blur-md text-[8px] font-black px-3 py-1 rounded-full border border-white/10 text-indigo-300" x-text="p.age"></span>
                        </div>
                    </div>
                    <div class="flex-grow">
                        <div class="flex justify-between items-start mb-2">
                            <h4 x-text="p.name" class="text-lg font-black italic text-white"></h4>
                            <span class="text-lg font-black text-indigo-400 italic" x-text="formatPrice(p.price)"></span>
                        </div>
                        <p class="text-[10px] text-zinc-600 font-bold uppercase mb-6" x-text="p.desc"></p>
                    </div>
                    <button @click="addToCart(p)" class="w-full py-4 neo-gradient rounded-2xl font-black text-xs uppercase shadow-lg hover:brightness-110 transition-all flex items-center justify-center gap-2">
                        إضافة للحقيبة <i data-lucide="plus-circle" class="w-4 h-4"></i>
                    </button>
                </div>
            </template>
        </div>
    </main>

    <!-- لوحة التحكم (Admin) -->
    <div x-show="isAdminOpen" x-transition x-cloak class="fixed inset-0 z-[1000] bg-black p-10 overflow-y-auto">
        <div class="max-w-6xl mx-auto">
            <div class="flex justify-between items-center mb-12">
                <h2 class="text-4xl font-black italic text-gradient tracking-tighter">لوحة مراقبة المبيعات</h2>
                <button @click="isAdminOpen = false" class="p-3 glass rounded-full"><i data-lucide="x"></i></button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <div class="glass p-8 rounded-3xl">
                    <p class="text-[10px] text-zinc-500 font-black uppercase mb-2">إجمالي المبيعات</p>
                    <h3 class="text-3xl font-black italic text-white" x-text="formatPrice(stats.revenue)"></h3>
                </div>
                <div class="glass p-8 rounded-3xl border-indigo-500/20">
                    <p class="text-[10px] text-zinc-500 font-black uppercase mb-2">عدد العمليات</p>
                    <h3 class="text-3xl font-black italic text-indigo-400" x-text="stats.count"></h3>
                </div>
                <div class="glass p-8 rounded-3xl border-green-500/20">
                    <p class="text-[10px] text-zinc-500 font-black uppercase mb-2">صافي الربح</p>
                    <h3 class="text-3xl font-black italic text-green-500" x-text="formatPrice(stats.profit)"></h3>
                </div>
            </div>
            <!-- قائمة الطلبات -->
            <div class="glass rounded-3xl overflow-hidden">
                <template x-for="order in orders" :key="order.id">
                    <div class="p-6 border-b border-white/5 flex justify-between items-center hover:bg-white/[0.02]">
                        <div>
                            <p class="font-black italic text-sm" x-text="order.items.join(' + ')"></p>
                            <p class="text-[9px] text-zinc-600 font-bold mt-1" x-text="order.timestamp?.toDate().toLocaleString('ar-EG')"></p>
                        </div>
                        <p class="text-xl font-black italic text-indigo-400" x-text="formatPrice(order.revenue)"></p>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- السلة الجانبية -->
    <div x-show="isCartOpen" x-transition x-cloak class="fixed inset-0 z-[1100]">
        <div class="absolute inset-0 bg-black/90" @click="isCartOpen = false"></div>
        <div class="absolute inset-y-0 left-0 w-full md:w-[450px] glass p-10 flex flex-col shadow-2xl">
            <div class="flex justify-between items-center mb-10">
                <h3 class="text-3xl font-black italic">الحقيبة</h3>
                <button @click="isCartOpen = false"><i data-lucide="x"></i></button>
            </div>
            <div class="flex-grow overflow-y-auto custom-scroll pr-4 space-y-6">
                <template x-for="(item, index) in cart" :key="index">
                    <div class="flex items-center gap-4 glass p-4 rounded-2xl">
                        <img :src="item.img" class="w-16 h-16 rounded-lg object-cover">
                        <div class="flex-grow">
                            <p class="font-black italic text-sm" x-text="item.name"></p>
                            <p class="text-indigo-400 font-black" x-text="formatPrice(item.price)"></p>
                        </div>
                        <button @click="removeFromCart(index)" class="text-zinc-700 hover:text-red-500 transition-colors"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                    </div>
                </template>
            </div>
            <div class="mt-10 pt-8 border-t border-white/5">
                <div class="flex justify-between items-end mb-8">
                    <p class="text-zinc-500 text-[10px] font-black uppercase">المجموع النهائي</p>
                    <p class="text-4xl font-black text-gradient" x-text="formatPrice(finalTotal())"></p>
                </div>
                <button @click="checkout()" class="w-full py-5 neo-gradient rounded-2xl font-black text-lg uppercase tracking-widest shadow-xl">إتمام الطلب</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";
        import Alpine from 'https://unpkg.com/alpinejs@3.x.x/dist/module.esm.js';

        window.hubApp = () => ({
            db: null, cart: [], orders: [], 
            isCartOpen: false, isAdminOpen: false, activeTab: 'all',
            currency: 'SAR', currentTime: '',
            stats: { revenue: 0, profit: 0, count: 0 },
            categories: [
                { id: 'all', name: 'الكل' },
                { id: 'baby', name: 'رضع (0-2)' },
                { id: 'kids', name: 'أطفال (3-12)' },
                { id: 'teens', name: 'مراهقين (13+)' }
            ],
            products: [
                { id: 'k1', cat: 'baby', age: '0-2 سنة', name: 'بذلة نيو-نوز القصيرة', price: 120, cost: 40, img: 'https://images.unsplash.com/photo-1522771935876-2497116a7a9e?auto=format&fit=crop&q=80&w=600', desc: 'قطن عضوي 100% مع أزرار مغناطيسية سهلة.' },
                { id: 'k2', cat: 'kids', age: '5-8 سنوات', name: 'طقم سايبر-بوي الرياضي', price: 245, cost: 90, img: 'https://images.unsplash.com/photo-1519238263530-99bdd11df2ea?auto=format&fit=crop&q=80&w=600', desc: 'تصميم عاكس للضوء مع تقنية تهوية متطورة.' },
                { id: 'k3', cat: 'teens', age: '14+ سنة', name: 'هودي الأوربان جين', price: 380, cost: 140, img: 'https://images.unsplash.com/photo-1515238152791-8216bfdf89a7?auto=format&fit=crop&q=80&w=600', desc: 'قصة واسعة (Oversized) مع جيب سري للأجهزة.' },
                { id: 'k4', cat: 'kids', age: '3-6 سنوات', name: 'فستان جالاكسي بيكسل', price: 210, cost: 70, img: 'https://images.unsplash.com/photo-1518831959646-742c3a14ebf7?auto=format&fit=crop&q=80&w=600', desc: 'ألوان متغيرة مع الإضاءة، مريح للحركة.' },
                { id: 'k5', cat: 'baby', age: '6-12 شهر', name: 'رداء التدفئة نيو-كوزي', price: 175, cost: 60, img: 'https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?auto=format&fit=crop&q=80&w=600', desc: 'مبطن بالفرو الصناعي فائق النعومة.' },
                { id: 'k6', cat: 'teens', age: '12-16 سنة', name: 'سترة الرياح نيو-شيل', price: 420, cost: 160, img: 'https://images.unsplash.com/photo-1520127877096-7427494273e9?auto=format&fit=crop&q=80&w=600', desc: 'مقاومة للماء والرياح بوزن خفيف جداً.' },
                { id: 'k7', cat: 'kids', age: '7-11 سنة', name: 'بنطال التك-كارغو', price: 195, cost: 65, img: 'https://images.unsplash.com/photo-1503944583220-79d8926ad5e2?auto=format&fit=crop&q=80&w=600', desc: 'جيوب متعددة مع مفاصل مرنة للجري واللعب.' },
                { id: 'k8', cat: 'teens', age: '13-18 سنة', name: 'تيشيرت نيو-لوغو برو', price: 140, cost: 45, img: 'https://images.unsplash.com/photo-1503910368127-b4428c7752d0?auto=format&fit=crop&q=80&w=600', desc: 'طباعة ثلاثية الأبعاد تدوم طويلاً.' }
            ],
            get filteredProducts() {
                if (this.activeTab === 'all') return this.products;
                return this.products.filter(p => p.cat === this.activeTab);
            },
            async init() {
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                const app = initializeApp(firebaseConfig);
                this.db = getFirestore(app);
                const auth = getAuth(app);
                await signInAnonymously(auth);
                this.loadOrders();
                setInterval(() => this.currentTime = new Date().toLocaleTimeString('en-US', { hour12: false }), 1000);
                lucide.createIcons();
            },
            loadOrders() {
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'neo-kids-hub-v8';
                const q = query(collection(this.db, 'artifacts', appId, 'public', 'data', 'orders'), orderBy('timestamp', 'desc'), limit(50));
                onSnapshot(q, (s) => {
                    this.orders = s.docs.map(d => ({ id: d.id, ...d.data() }));
                    this.stats.revenue = this.orders.reduce((sum, o) => sum + (o.revenue || 0), 0);
                    this.stats.profit = this.orders.reduce((sum, o) => sum + (o.profit || 0), 0);
                    this.stats.count = this.orders.length;
                    this.$nextTick(() => lucide.createIcons());
                });
            },
            formatPrice(p) {
                const rates = { SAR: 1, USD: 0.27, EUR: 0.25 };
                const converted = p * rates[this.currency];
                return converted.toLocaleString('ar-SA') + ' ' + (this.currency === 'SAR' ? 'ر.س' : this.currency);
            },
            addToCart(p) { this.cart.push(p); this.isCartOpen = true; this.$nextTick(() => lucide.createIcons()); },
            removeFromCart(i) { this.cart.splice(i, 1); },
            finalTotal() { return this.cart.reduce((s, i) => s + i.price, 0); },
            async checkout() {
                if (this.cart.length === 0) return;
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'neo-kids-hub-v8';
                const revenue = this.finalTotal();
                const cost = this.cart.reduce((s, i) => s + i.cost, 0);
                try {
                    await addDoc(collection(this.db, 'artifacts', appId, 'public', 'data', 'orders'), {
                        revenue, profit: revenue - cost, items: this.cart.map(i => i.name), timestamp: serverTimestamp()
                    });
                    this.cart = []; this.isCartOpen = false;
                    alert("✅ تم استلام الطلب! جاري تجهيز ملابس الجيل القادم.");
                } catch (e) { alert("خطأ في الاتصال بالشبكة."); }
            }
        });
        Alpine.start();
    </script>
</body>
</html>

